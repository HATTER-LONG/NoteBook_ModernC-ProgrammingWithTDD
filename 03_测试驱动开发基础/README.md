# 总结

- [总结](#总结)
  - [TDD 的前进规则](#tdd-的前进规则)
  - [TDD 三条准则](#tdd-三条准则)
  - [可能遇到的错误](#可能遇到的错误)
  - [成功运用 TDD 的方法](#成功运用-tdd-的方法)
  - [TDD QA](#tdd-qa)

TDD 的开发周期：

1. 先写一个测试（“红”）；
2. 让测试通过（“绿”）；
3. 优化设计（“重构”）。

![TDDProcess](./pic/1_TDD_Process.png)

> 就像第二章中描述的步骤一样，这里将其精简。

## TDD 的前进规则

在 TDD 周期中的每一步，你必须能回答以下问题：

1. 确定测试目标：
   - 怎样才算可以增量开发的最小行为？
   - 系统中已经存在这样的行为了么？
   - 怎样让测试名称准确表达行为？
   - 测试中使用的接口是客户端代码使用这一行为最好的方式吗？
   - 以上问题可以参考[成功运用 TDD 的方法](#成功运用-tdd-的方法)
2. 确保新的测试是失败的：
   - 如果没有失败，为什么？
   - 这个行为已经在系统中存在了么？
   - 是否是忘记了编译差异代码？
   - 是不是在上一个测试中步伐太大了，包含了多个行为？
   - 断言是否有效？
3. 写出你认为可以让测试通过的代码：
   - 代码是不是刚好满足测试说明的行为要求？
   - 你清楚刚才写的代码中哪些地方需要整理么？
   - 是否遵循了团队标准？
4. 确保所有测试都能通过：
   - 如果没有，你的编码是否正确？
   - 你的规范正确么？
5. 整理刚才的代码改动：
   - 怎么做才能使你的代码符合团队标准？
   - 新的代码和系统中其他要清除的代码有重复么？
   - 代码有没有坏味？
   - 遵循好的设计原则了吗？
   - 除了当下要做的设计和代码整理工作，你还知道其他什么？
   - 设计是朝好的方向发展吗？
   - 你的代码改动会导致需要修改其他地方的代码吗？
6. 确保所有测试再次通过：
   - 确信你的单元测试覆盖率够高吗？
   - 是不是应该运行一些速度较慢的测试集合，以便有信息继续前行？
   - 下一个测试是什么？

## TDD 三条准则

1. 只在让失败测试通过时才编写产品代码。
2. 当测试刚好失败时，停止继续编写。编译失败也是失败。
3. 只编写能刚好让一个失败测试通过的产品代码。

## 可能遇到的错误

1. 表里不一：即出现了与我们期望的情况以外的现象。例如新增了个测试确没有生效？又或者增加了一个系统已有的行为测试，导致测试代码提前成功了？等等
   - 测试提前通过的情况应该很少见。但是这种情形却很重要，可以问自己几个问题：我漏掉了什么？我的步伐是不是大了点儿？我有没有犯愚蠢的错误？如果不这样做会是什么结果呢？和编译警告一样，你始终要去揣摩测试提前通过背后的真相。
2. 增量性：TDD 以渐进的方式从无到有地开发一个功能完善的系统，保证遵循准则 1。
3. 测试行为而非方法：想要测试全面方法时很困难的，应该测试代码所支持的行为。
4. 用良好的测试描述除行为。可以通过下列两个方面来编写一个良好的测试：
   - 测试名称，它概括了在特定上下文中系统表现出的行为；
   - 测试语句本身，它精炼地展现了一个测试的行为。
5. 保持简单：保持简单才是在持续变化的环境中的生存之道。最好的防范办法就是保持简单的设计：代码易读、没有冗余、没有无谓的复杂性。具有这些特征的系统会最大程度地降低维护成本。
6. 恪守测试驱动开发周期：请遵循“红-绿-重构”周期，非常重要。

## 成功运用 TDD 的方法

1. **下一个测试是什么**，这是 TDD 正确前进的重要问题，文中给出三种方案：
   1. 如果一个测试需要的产品代码最少，那么就写这个测试。
   2. 使用`变换优先级假设（Transformation Priority Premise，TPP）`模式。
   3. 可以回答下列问题做出决定：
      1. 从逻辑上来说，那个行为最具有意义？
      2. 你可以验证这个有意义的行为中哪个最小集合？
      3. 你能写一个测试来说明当前的行为不完备吗？
2. **十分钟限制**：出现问题开始十分钟如果解决不了，应该回滚并换一种思路了。
3. **代码缺陷**：TDD 不是银弹无法完全消除错误，但是却有助于消除一些人人都会犯的逻辑错误（更重要的是，它是精细打磨系统设计的绝妙方法。）。当发现了一个新的问题最好的方式便是将错误通过测试代码进行描述，进入“红-绿-重构”周期。
4. **禁用测试**：正常情况下，在测试驱动开发时一次只关注一件事情。个别情况下，当你忙于让第一个测试通过时，第二个测试失败了。为了不让第二个失败的测试分散你的注意力，可以让它暂时失效。但是不要提交这种被禁用的测试用例，除非你有足够的理由，并且做好完善的备注，避免给别人误导。

## TDD QA

1. TDD 的好处？
   - 与 POUT 即开发完成后再编写测试不同，TDD 事一个更加简明的流程，并且也使用了单元测试。在 TDD 中先编写测试，并且保持测试的粒度尽量小且一致，这样会带来许多好处，最重要的是可以安全地修改现有代码。
2. 如何进行 TDD？
   - 在 TDD 中，是以非常小的步伐，增量地往系统中添加新行为。换句话说，为了往系统中加入新的行为，首先会去写一个测试来定义这个行为。这个起初运行失败的测试将驱使你去实现相应的行为。
3. TDD 与功能测试的区别？
   - TDD 不应该和大量功能的测试混淆。主要区别在于，覆盖了大量功能的测试是与其他代码或者外部实体集成后的整体功能，一般被称为集成测试。此类测试应在验收或者系统测试时进行。
   - TDD 主导的是产生单元测试，是去覆盖最小的逻辑代码单元的测试用例。虽说 TDD 在失败测试通过时才编写产品代码的规则，往往会指引者开发者与外部实体代码进行交互，进而编程集成测试，但是者没有关系。**重要的是现指定行为，系统地测试驱动开发系统中的每一块代码**。
