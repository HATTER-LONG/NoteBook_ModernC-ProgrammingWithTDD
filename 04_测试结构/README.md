# 总结

- [总结](#总结)
  - [测试代码的组织方式](#测试代码的组织方式)
    - [fixture 方式注意](#fixture-方式注意)
  - [集成测试与过滤器](#集成测试与过滤器)
    - [运行测试的一个子集](#运行测试的一个子集)
  - [断言](#断言)
  - [探查私有](#探查私有)
    - [私用成员](#私用成员)
    - [私用方法](#私用方法)
  - [参数化测试](#参数化测试)

## 测试代码的组织方式

- 文件的组织方式：
  - 相关的测试定义在同一个测试文件中。最终可能需要多个测试文件来验证相关行为，也可能需要用一个测试文件覆盖多个地方行为，所以**不用拘泥于一个类一个测试文件的形式**。

- 逻辑上组织方式：
  1. fixture 方式，以及如何利用 setup 和 teardown 钩子函数。
  2. 如何使用 Given-When-Then 的概念来组织。

### fixture 方式注意

如果同一个类的测试需要两个不同的 fixture 的话，这有可能意味着你正在测试的类违反了单一责任原则，你可能需要将它们拆分为两个类。

## 集成测试与过滤器

如果编写的是小而独立的代码单元，那么每个测试都会运行得快如闪电。但是一旦与一些外部慢速资源（如数据库或其他慢速服务）交互的话，那么测试就会变慢。这些测试不在是单元测试，一般称为集成测试。

而 TDD 的核心目标就是尽可能频繁地获得较多的反馈。当修改了一点代码时，会马上想知道改动是否正确，影响到了其他代码？这时如果运行测试时间很长，那么就不会频繁的运行他们，一旦反馈周期变长，TDD 的威力就急剧减弱。因为越晚察觉到的问题，修改所需的耗费就更长。

**因此请注意单元测试是否有过多与外部的依赖，思考使用 MOCK 技术（请查看第5章节）**。

### 运行测试的一个子集

当前的测试框架都是支持通过命令运行单一子集的测试用例，可以跳过或者关闭速度慢的集成测试。具体使用请查阅当前正在生效的测试框架文档。

## 断言

断言是自动化测试的核心，它替代了人工检查的结果。当测试框架运行单个测试时，它会验证每一个遇到的测试，是否与期待的结果一致，一但条件不满足便会测试失败，并终止。

有些工具，包括 Google Mock 与 Catch2，提供了另一种断言机制，它允许测试在遇到断言失败的情况下继续运行。这些断言又称作非致命性断言，与致命性断言相对，后者会中止测试。

## 探查私有

### 私用成员

假如遇到一些情况需要判断类的私用数据，将数据暴露出来仅仅为了测试这对于设计来说并不合理，**应该考虑用验证行为来替代掉直接对私用成员的判别**。

### 私用方法

大多数时候，当你觉得需要测试私有行为时，可以尝试将代码移到另一个类或为之创建的一个新类。

## 参数化测试

测试与测试驱动是不同的：

1. 测试要求的是全面覆盖：无（zero）、有（one）、多（many）、边界（boundary）和异常（exceptional）情形。优秀的测试人员会竭尽所能地去覆盖上面所说的五类情形。
2. 测试驱动开发的目的：是为了保证代码能够符合预定规范。虽然测试和测试驱动都能够保证你有足够的信心去发布代码，但是一旦对所构建的东西有足够的信心，就可以停止 TDD。

**在测试驱动开发时，追求的是快速且独立的测试，所以不需要这种测试间的依赖关系，因为它会让事情变得复杂。**
